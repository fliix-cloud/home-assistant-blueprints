blueprint:
  name: Reolink Kamera Benachrichtigung bei Bewegungserkennung
  description: Sendet ein Bild von der Reolink Kamera per Pushover, wenn eine Person, ein Besucher, ein Paket, ein Tier oder ein Auto erkannt wird, aber nur einmal alle 60 Sekunden.
  domain: automation
  input:
    camera_entity:
      name: Kamera
      description: Die Kamera, die das Bild liefern soll.
      selector:
        entity:
          domain: camera
    motion_sensor:
      name: Bewegungssensor
      description: Der Bewegungssensor, der den 1/0 Zustand liefert.
      selector:
        entity:
          domain: binary_sensor
    detected_object:
      name: Erkanntes Objekt
      description: Beschreibe das erkannte Objekt (z.B. Person, Besucher, Paket, Tier, Auto)
      selector:
        text:
    interval:
      name: Minimaler Intervall
      description: Minimaler Zeitabstand (in Sekunden) zwischen zwei Benachrichtigungen.
      default: 60
      selector:
        number:
          min: 10
          max: 600
          unit_of_measurement: seconds

mode: single

trigger:
  - platform: state
    entity_id: !input motion_sensor
    from: "off"
    to: "on"

condition:
  - condition: template
    value_template: "{{ (as_timestamp(now()) - as_timestamp(state_attr(this.entity_id, 'last_triggered') | default(0))) | int > (input.interval | int) }}"

action:
  - variables:
      snapshot_file: "/config/www/snapshot_{{ states.entity_id | replace('.', '_') }}.jpg"
      artikel: >
        {% if !input.detected_object in ["Besucher", "Paket", "Auto", "Tier"] %}
          Ein
        {% else %}
          Eine
        {% endif %}
  
  - service: camera.snapshot
    data:
      entity_id: !input camera_entity
      filename: "{{ snapshot_file }}"
  
  - service: notify.pushover_reolink
    data:
      title: "{{ artikel }} {{ !input.detected_object }} wurde erkannt!"
      message: "{{ artikel }} {{ !input.detected_object }} wurde erkannt."
      data:
        attachment: "{{ snapshot_file }}"
